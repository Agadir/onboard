<!DOCTYPE html>
<% 
  require 'hmenu'

  title ||= nil # avoid NameError if no title was set
%> 
<html>
  <head>
    <title><%= OnBoard::LONGNAME %><%= " - #{title}" if title %></title> 
    <link rel="stylesheet" href="/css/default.css"/>
    <link rel="icon" href="/icons/favicon.ico"/>
    <style type="text/css">
      <%= ::HMenu::CSS.out %>
    </style>

    <script type="text/javascript">
      <%= ::HMenu::JS.out %>
    </script>

  </head>
  <body onload="reset_menus();"> 
    <div id="sidebar">
      <div id="onboard-menu">
        <%= 
          OnBoard::MENU_ROOT.to_html_ul do |node, output|
            if node.content
              if request.path_info ==  node.content[:href]
                output[:href] = nil
                output[:extra_class] = "hmenu-selected"
              # That's why I love Ruby: node.content[:children] may
              # be a String, a Regexp or even a block of code! (lambda) 
              elsif node.content[:children] === request.path_info              
                output[:extra_class] = "hmenu-selected" unless
                    # do not highlight if any descendant matches already
                    node.any? do |n| 
                      n.content[:href]      ==  request.path_info or
                      n.content[:children]  === request.path_info and
                      n                     !=  node # exclude itself
                    end
              end
            end
          end
        %>
      </div>
    </div>
    <div id="main">

      <%= erubis(:"_navbar.html", :layout => false) %>

      <%= 
        erubis(
          :"_altbar.html", 
          :layout => false,
          :locals => {
            :formats => formats
          }
        ) 
      %>
      <%= yield %>
      <pre id="jsdebug"></pre>
    </div>
  </body>
</html>
