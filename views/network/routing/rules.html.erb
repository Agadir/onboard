<% 
  require 'onboard/network/routing'
  require 'onboard/network/qos/diffserv'

  all_tables      = OnBoard::Network::Routing::Table.getAllIDs 
  all_interfaces  = OnBoard::Network::Interface.getAll 
  all_rules       = objects 

%>

<style type="text/css">
  td input, td select {
    margin: 0 auto 0 0.3em;
  }
</style>

<h2>Advanced Routing: Rules</h2>

<pre><%= html_escape params.pretty_inspect %></pre>

<%= 
  erb(
    :"_messages.html",
    {
      :layout => false,
      :locals => {
        :msg    => msg
      }
    }
  )
%>

<h3>Current rules</h3>

<%=
  erb(
    :"network/routing/_rules.html",
    {
      :layout => false,
      :locals => {
        :all_tables     => all_tables,
        :all_interfaces => all_interfaces,
        :all_rules      => all_rules
      }
    }
  )    
%>
<button type="submit">Change</button> 

<h3>Add a new rule</h3>

<form method="POST">
  <%=
    erb(
      :"network/routing/_rules.html",
      {
        :layout => false,
        :locals => {
          :all_tables     => all_tables,
          :all_interfaces => all_interfaces,
          :all_rules      => [ 
            OnBoard::Network::Routing::Rule.new( { # blank slate
              :prio   => nil,
              :from   => 'all',
              :to     => 'all',
              :fwmark => nil,
              :table  => 'main'
            } ) 
          ]
        }
      }
    )    
  %>
  <button type="submit">Add</button>
</form>
