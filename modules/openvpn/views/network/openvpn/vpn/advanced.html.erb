<% 
  require 'onboard/system/log'

  vpn = objects
  log = OnBoard::System::Log.new({'path' => vpn.logfile}) 
%>
<style type="text/css">
  table tr td {
    padding: 0.5em;
  }
</style>
<h2>VPN<%= "##{vpn.data['human_index']}" if vpn.data['human_index'] %> details</h2>
<% if vpn.data['server'] %>
  <h3>Advanced, per-client configuration</h3>
  <table>
    <thead>
      <tr>
        <th>
          &ldquo;Common Name&rdquo;
        </th>
        <th>
          Route networks
          <div class="optinfo">  
            List of networks, one per line, which are behind the client and
            you want to make securely accessible through the VPN.
          </div>
        </th>
        <th>
          Push routes
          <div class="optinfo">  
            List of networks, one per line, which are behind this server
            and you want to make securely accessible from the client.
          </div>
        </th>
        <th>
          Delete?
        </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>example_CN</code></td>
        <td>
          <textarea cols=16 rows=2 wrap=off>192.168.33.0/24</textarea> 
        </td>
        <td>
          <textarea cols=16 rows=2 wrap=off>192.168.35.0/24
192.168.36.0/24</textarea>
        </td>
        <td style="text-align: center;">
          <button><img src="<%= icondir + '/' + iconsize + '/actions/delete.png'%>" alt="Delete"/></button> 
        </td>
      </tr>
      <tr>
        <td><input type="text" class="rwtext"/></td>
        <td>
          <textarea cols=16 rows=2 wrap=off></textarea> 
        </td>
        <td>
          <textarea cols=16 rows=2 wrap=off></textarea>
        </td>
        <td style="text-align: center;">
        </td>
      </tr>
    </tbody>
  </table>
  <button>Change!</button>
<% end %>
<% if vpn.data['clients'] %><!-- It's a server -->
  <h3>Connected clients</h3>
  <% if vpn.data['status_update_seconds'] %>
    <p class="optinfo">List updated every <%= vpn.data['status_update_seconds'] %> seconds.</p>
  <% end %>
  <table>
    <thead>
      <tr>
        <th>&ldquo;Common Name&rdquo;</th>
        <th>Real Address/Port</th>
        <th>Virtual Address</th>
        <th>Bytes Received</th>
        <th>Bytes Sent</th>
        <th>Connected Since</th>
      </tr>
    </thead>
    <tbody>
      <% vpn.data['clients'].each do |client| %>
        <tr>
          <td><code><%= client['Common Name'] %></code></td>
          <td><%= client['Real Address'] %></td>
          <td><%= client['Virtual Address'] %></td>
          <td><%= client['Bytes Received'] %></td>
          <td><%= client['Bytes Sent'] %></td>
          <td><%= client['Connected Since'] %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>
<h3><span class="product-name">OpenVPN</span> log</h3>
<%=
  erb(:"system/_log.html", :layout => false, :locals => {:log => log})
%>


